# 📋 ТРЕБОВАНИЯ И ЗАВИСИМОСТИ ПРОЕКТА VERETEVO TEAM

## 🐍 ТРЕБОВАНИЯ К СИСТЕМЕ

### Операционная система
- **Linux** (Ubuntu 20.04+ рекомендуется)
- **Python 3.8+** (рекомендуется Python 3.9+)

### Системные требования
- **RAM**: минимум 512MB, рекомендуется 1GB+
- **Дисковое пространство**: минимум 100MB
- **Сеть**: стабильное интернет-соединение
- **Время**: настроен часовой пояс Europe/Moscow

## 📦 ЗАВИСИМОСТИ PYTHON

### Основные библиотеки

```bash
# Telegram Bot API
python-telegram-bot==20.7

# HTTP запросы
requests==2.31.0

# Работа с переменными окружения
python-dotenv==1.0.0

# Работа с датами и временем
pytz==2023.3

# Асинхронное программирование
asyncio==3.4.3

# Логирование
logging==0.4.9.6

# JSON обработка
json5==0.9.14

# UUID генерация
uuid==1.30
```

### Yandex интеграции

```bash
# Yandex SpeechKit для голосовых сообщений
yandex-speechkit==2.4.0

# Yandex GPT API
yandex-gpt==0.1.0

# Yandex Cloud SDK
yandexcloud==0.227.0
```

### Дополнительные утилиты

```bash
# Работа с файлами
pathlib==1.0.1

# Валидация данных
pydantic==2.5.0

# Типизация
typing-extensions==4.8.0

# Тестирование
pytest==7.4.3
pytest-asyncio==0.21.1
```

## 🔧 УСТАНОВКА ЗАВИСИМОСТЕЙ

### Создание requirements.txt

```bash
# Создаем файл requirements.txt
cat > requirements.txt << 'EOF'
python-telegram-bot==20.7
requests==2.31.0
python-dotenv==1.0.0
pytz==2023.3
asyncio==3.4.3
logging==0.4.9.6
json5==0.9.14
uuid==1.30
yandex-speechkit==2.4.0
yandex-gpt==0.1.0
yandexcloud==0.227.0
pathlib==1.0.1
pydantic==2.5.0
typing-extensions==4.8.0
pytest==7.4.3
pytest-asyncio==0.21.1
EOF
```

### Установка зависимостей

```bash
# Обновляем pip
pip install --upgrade pip

# Устанавливаем зависимости
pip install -r requirements.txt

# Проверяем установку
python -c "import telegram; import requests; import yandex_speechkit; print('✅ Все зависимости установлены')"
```

## 🔑 НАСТРОЙКА ПЕРЕМЕННЫХ ОКРУЖЕНИЯ

### Создание .env файла

```bash
# Создаем файл .env
cat > .env << 'EOF'
# Telegram Bot Configuration
TELEGRAM_TOKEN=ваш_токен_бота_здесь
ASSISTANTS_CHAT_ID=id_чата_ассистентов
FINANCE_CHAT_ID=id_финансового_чата

# Yandex SpeechKit Configuration
YANDEX_SPEECHKIT_API_KEY=ваш_ключ_speechkit
YANDEX_FOLDER_ID=ваш_folder_id_yandex_cloud

# Yandex GPT Configuration
YANDEX_GPT_API_KEY=ваш_ключ_yandex_gpt

# Todoist Configuration (если используется)
TODOIST_API_TOKEN=ваш_токен_todoist
EOF
```

### Получение токенов

#### Telegram Bot Token
1. Написать @BotFather в Telegram
2. Команда `/newbot`
3. Следовать инструкциям
4. Скопировать полученный токен

#### Yandex SpeechKit API Key
1. Зарегистрироваться в Yandex Cloud
2. Создать SpeechKit сервис
3. Получить API ключ в консоли

#### Yandex GPT API Key
1. В Yandex Cloud создать GPT сервис
2. Получить API ключ для GPT

## 🚀 НАСТРОЙКА СИСТЕМЫ

### Создание systemd сервиса

```bash
# Создаем файл сервиса
sudo tee /etc/systemd/system/veretevo-bot.service << 'EOF'
[Unit]
Description=Veretevo Team Bot
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/bots/VeretevoTeam
Environment=PATH=/home/ubuntu/.local/bin:/usr/local/bin:/usr/bin:/bin
ExecStart=/usr/bin/python3 main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# Перезагружаем systemd
sudo systemctl daemon-reload

# Включаем автозапуск
sudo systemctl enable veretevo-bot

# Запускаем сервис
sudo systemctl start veretevo-bot

# Проверяем статус
sudo systemctl status veretevo-bot
```

### Настройка логирования

```bash
# Создаем папку для логов
mkdir -p logs

# Устанавливаем права
chmod 755 logs

# Создаем файл конфигурации логов
cat > logs/logging.conf << 'EOF'
[loggers]
keys=root,bot

[handlers]
keys=consoleHandler,fileHandler

[formatters]
keys=normalFormatter

[logger_root]
level=INFO
handlers=consoleHandler

[logger_bot]
level=DEBUG
handlers=consoleHandler,fileHandler
qualname=bot
propagate=0

[handler_consoleHandler]
class=StreamHandler
level=INFO
formatter=normalFormatter
args=(sys.stdout,)

[handler_fileHandler]
class=FileHandler
level=DEBUG
formatter=normalFormatter
args=('logs/bot.log', 'a', 'utf-8')

[formatter_normalFormatter]
format=%(asctime)s - %(name)s - %(levelname)s - %(message)s
datefmt=%Y-%m-%d %H:%M:%S
EOF
```

## 🔍 ПРОВЕРКА УСТАНОВКИ

### Тест основных компонентов

```bash
# Проверяем Python
python3 --version

# Проверяем pip
pip --version

# Проверяем установленные пакеты
pip list | grep -E "(telegram|requests|dotenv|pytz)"

# Тест импорта основных модулей
python3 -c "
import telegram
import requests
import json
import logging
import asyncio
import pytz
from datetime import datetime
print('✅ Все основные модули импортируются успешно')
"
```

### Тест конфигурации

```bash
# Проверяем наличие .env файла
if [ -f ".env" ]; then
    echo "✅ .env файл найден"
else
    echo "❌ .env файл не найден"
fi

# Проверяем переменные окружения
python3 -c "
import os
from dotenv import load_dotenv
load_dotenv()

required_vars = ['TELEGRAM_TOKEN', 'ASSISTANTS_CHAT_ID']
missing_vars = [var for var in required_vars if not os.getenv(var)]

if missing_vars:
    print(f'❌ Отсутствуют переменные: {missing_vars}')
else:
    print('✅ Все обязательные переменные настроены')
"
```

## 📊 МОНИТОРИНГ И ЛОГИ

### Просмотр логов

```bash
# Просмотр логов в реальном времени
tail -f logs/bot.log

# Просмотр последних 100 строк
tail -n 100 logs/bot.log

# Поиск ошибок
grep -i "error\|exception" logs/bot.log

# Поиск уведомлений о запуске
grep -i "запущен\|started" logs/bot.log
```

### Проверка статуса сервиса

```bash
# Статус systemd сервиса
sudo systemctl status veretevo-bot

# Проверка процессов
ps aux | grep python | grep main.py

# Проверка портов (если используется)
netstat -tlnp | grep python
```

## 🛠️ УСТРАНЕНИЕ ПРОБЛЕМ

### Частые проблемы

#### 1. Ошибка импорта модулей
```bash
# Решение: переустановка зависимостей
pip install --upgrade -r requirements.txt
```

#### 2. Ошибка прав доступа
```bash
# Решение: установка правильных прав
chmod +x scripts/*.sh
chmod 755 logs/
chmod 644 .env
```

#### 3. Ошибка переменных окружения
```bash
# Решение: проверка .env файла
cat .env
python3 -c "from dotenv import load_dotenv; load_dotenv(); import os; print(os.getenv('TELEGRAM_TOKEN'))"
```

#### 4. Ошибка синхронизации с Todoist
```bash
# Решение: проверка токена Todoist
python3 -c "import os; from dotenv import load_dotenv; load_dotenv(); print('Todoist token:', os.getenv('TODOIST_API_TOKEN', 'не установлен'))"
```

## 📈 ПРОИЗВОДИТЕЛЬНОСТЬ

### Рекомендуемые настройки

```bash
# Ограничение использования памяти
ulimit -v 1048576  # 1GB

# Ограничение количества файлов
ulimit -n 1024

# Настройка Python
export PYTHONOPTIMIZE=1
export PYTHONUNBUFFERED=1
```

### Мониторинг ресурсов

```bash
# Мониторинг CPU и памяти
htop

# Мониторинг дискового пространства
df -h

# Мониторинг сетевых соединений
netstat -i
```

---

**Дата создания**: $(date +'%Y-%m-%d %H:%M:%S')
**Версия документа**: 1.0
**Статус**: Актуально
