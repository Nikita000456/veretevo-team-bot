#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ —á–∞—Ç –æ—Ö—Ä–∞–Ω—ã
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from services_veretevo.department_service import load_departments, get_user_departments, DEPARTMENTS

def test_current_security_members():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞ –æ—Ö—Ä–∞–Ω—ã"""
    print("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞ –æ—Ö—Ä–∞–Ω—ã...")
    
    load_departments()
    security_dept = DEPARTMENTS.get("security", {})
    
    print(f"üìã –û—Ç–¥–µ–ª: {security_dept.get('name', '–û—Ö—Ä–∞–Ω–∞')}")
    print(f"üÜî ID —á–∞—Ç–∞: {security_dept.get('chat_id', '–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω')}")
    print(f"üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ ({len(security_dept.get('members', {}))}):")
    
    for user_id, user_name in security_dept.get("members", {}).items():
        print(f"   - {user_name} (ID: {user_id})")
    
    print()

def test_user_departments():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤ –∫–∞–∫–∏—Ö –æ—Ç–¥–µ–ª–∞—Ö —Å–æ—Å—Ç–æ—è—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"""
    print("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–¥–µ–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    test_users = [
        (406325177, "–ù–∏–∫–∏—Ç–∞ –ê—Å—Ç–∞–ø–æ–≤"),
        (979181458, "–ê–ª–∏–Ω–∞ –ê–ª–µ–∫—Å–µ–µ–≤–Ω–∞"),
        (484411013, "–°–æ—Ñ—å—è –ï–ª–∏—Å–µ–µ–≤–∞"),
        (1596376468, "–ú–∞—Ä–∏—è"),
        (1119513062, "–ù–∞—Ç–∞—à–∞")
    ]
    
    for user_id, user_name in test_users:
        departments = get_user_departments(user_id)
        dept_names = [dept[1] for dept in departments]
        print(f"üë§ {user_name} (ID: {user_id}): {', '.join(dept_names) if dept_names else '–ù–µ —Å–æ—Å—Ç–æ–∏—Ç –Ω–∏ –≤ –æ–¥–Ω–æ–º –æ—Ç–¥–µ–ª–µ'}")
    
    print()

def simulate_new_member():
    """–°–∏–º—É–ª–∏—Ä—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ —á–∞—Ç –æ—Ö—Ä–∞–Ω—ã"""
    print("üß™ –°–∏–º—É–ª—è—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ —á–∞—Ç –æ—Ö—Ä–∞–Ω—ã...")
    
    # –°–∏–º—É–ª–∏—Ä—É–µ–º –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    new_user_id = 123456789
    new_user_name = "–ù–æ–≤—ã–π –û—Ö—Ä–∞–Ω–Ω–∏–∫"
    
    load_departments()
    security_dept = DEPARTMENTS.get("security", {})
    
    # –î–æ–±–∞–≤–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç GroupMonitor)
    if "members" not in security_dept:
        security_dept["members"] = {}
    
    security_dept["members"][str(new_user_id)] = new_user_name
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω
    departments = get_user_departments(new_user_id)
    dept_names = [dept[1] for dept in departments]
    
    print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫: {new_user_name} (ID: {new_user_id})")
    print(f"üìã –¢–µ–ø–µ—Ä—å —Å–æ—Å—Ç–æ–∏—Ç –≤ –æ—Ç–¥–µ–ª–∞—Ö: {', '.join(dept_names) if dept_names else '–ù–µ —Å–æ—Å—Ç–æ–∏—Ç –Ω–∏ –≤ –æ–¥–Ω–æ–º –æ—Ç–¥–µ–ª–µ'}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á
    print(f"üéØ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á –æ–Ω –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –æ—Ç–¥–µ–ª–µ: –û—Ö—Ä–∞–Ω–∞")
    
    print()

def test_task_creation_scenario():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞"""
    print("üß™ –°—Ü–µ–Ω–∞—Ä–∏–π —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞...")
    
    # –°–∏–º—É–ª–∏—Ä—É–µ–º –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    new_user_id = 987654321
    new_user_name = "–¢–µ—Å—Ç–æ–≤—ã–π –û—Ö—Ä–∞–Ω–Ω–∏–∫"
    
    load_departments()
    security_dept = DEPARTMENTS.get("security", {})
    
    # –î–æ–±–∞–≤–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞
    if "members" not in security_dept:
        security_dept["members"] = {}
    
    security_dept["members"][str(new_user_id)] = new_user_name
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
    departments = get_user_departments(new_user_id)
    
    if departments:
        print(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {new_user_name} –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏")
        print(f"üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç–¥–µ–ª—ã: {[dept[1] for dept in departments]}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
        print(f"üë• –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á –æ–Ω –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å")
    else:
        print(f"‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {new_user_name} –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏")
    
    print()

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üöÄ === –¢–ï–°–¢ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –î–û–ë–ê–í–õ–ï–ù–ò–Ø –í –ß–ê–¢ –û–•–†–ê–ù–´ ===\n")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    test_current_security_members()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–¥–µ–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    test_user_departments()
    
    # –°–∏–º—É–ª–∏—Ä—É–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    simulate_new_member()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á
    test_task_creation_scenario()
    
    print("‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
    print("\nüìã –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã:")
    print("1. ‚úÖ –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ —á–∞—Ç –æ—Ö—Ä–∞–Ω—ã —á–µ–ª–æ–≤–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö")
    print("2. ‚úÖ –ï–º—É –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π —á–∞—Ç –±–æ—Ç–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ '–û—Ö—Ä–∞–Ω–∞'")
    print("3. ‚úÖ –û–Ω –±—É–¥–µ—Ç —Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–¥–µ–ª–æ–≤")
    print("4. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤")

if __name__ == "__main__":
    main() 